\section{\module{stat} ---
         \function{stat()} の返す内容を解釈する}

\declaremodule{standard}{stat}
\modulesynopsis{\function{os.stat()}、\function{os.lstat()} および
\function{os.fstat()} の返す内容を解釈するためのユーティリティ群。}
\sectionauthor{Skip Montanaro}{skip@automatrix.com}


\module{stat} モジュールでは、\function{os.stat()}、
\function{os.lstat()} および \function{os.fstat()} (存在すれば) の返す
内容を解釈するための定数や関数を定義しています。\cfunction{stat()}、
\cfunction{fstat()}、および \cfunction{lstat()} の関数呼び出しについての
完全な記述はシステムのドキュメントを参照してください。

\module{stat} モジュールでは、特殊なファイル型を判別するための以下の
関数を定義しています:


\begin{funcdesc}{S_ISDIR}{mode}
ファイルのモードがディレクトリの場合にゼロでない値を返します。
\end{funcdesc}

\begin{funcdesc}{S_ISCHR}{mode}
ファイルのモードがキャラクタ型の特殊デバイスファイルの場合にゼロでない値を返します。
\end{funcdesc}

\begin{funcdesc}{S_ISBLK}{mode}
ファイルのモードがブロック型の特殊デバイスファイルの場合にゼロでない値を返します。
\end{funcdesc}

\begin{funcdesc}{S_ISREG}{mode}
ファイルのモードが通常ファイルの場合にゼロでない値を返します。
\end{funcdesc}

\begin{funcdesc}{S_ISFIFO}{mode}
ファイルのモードが FIFO (名前つきパイプ) の場合にゼロでない値を返します。
\end{funcdesc}

\begin{funcdesc}{S_ISLNK}{mode}
ファイルのモードがシンボリックリンクの場合にゼロでない値を返します。
\end{funcdesc}

\begin{funcdesc}{S_ISSOCK}{mode}
ファイルのモードがソケットの場合にゼロでない値を返します。
\end{funcdesc}


より一般的なファイルのモードを操作するための二つの関数が定義されています:

\begin{funcdesc}{S_IMODE}{mode}
\function{os.chmod()} で設定することのできる一部のファイルモード
--- すなわち、ファイルの許可ビット (permission bits) に加え、
(サポートされているシステムでは) スティッキービット (sticky bit)、
実行グループ ID 設定 (set-group-id) および 実行ユーザ ID 設定 
(set-user-id) ビット --- を返します。
\end{funcdesc}

\begin{funcdesc}{S_IFMT}{mode}
ファイルの形式を記述しているファイルモードの一部 (上記の 
\function{S_IS*()} 関数で使われます) を返します。
\end{funcdesc}

通常、ファイルの形式を調べる場合には \function{os.path.is*()} 関数
を使うことになります; ここで挙げた関数は同じファイルに対して
複数のテストを同時に行いたいが、\cfunction{stat()} システムコール
を何度も呼び出してオーバヘッドが生じるのを避けたい場合に便利です。
これらはまた、ブロック型およびキャラクタ型デバイスに対するテスト
のように、\refmodule{os.path} で扱うことのできないファイルの
情報を調べる際にも便利です。

以下の全ての変数は、\function{os.stat()}、 \function{os.fstat()}、または
\function{os.lstat()} が返す 10 要素のタプルにおけるインデクスを単に
シンボル定数化したものです。

\begin{datadesc}{ST_MODE}
I ノードの保護モード。
\end{datadesc}

\begin{datadesc}{ST_INO}
I ノード番号。
\end{datadesc}

\begin{datadesc}{ST_DEV}
I ノードが存在するデバイス。
\end{datadesc}

\begin{datadesc}{ST_NLINK}
該当する I ノードへのリンク数。
\end{datadesc}

\begin{datadesc}{ST_UID}
ファイルの所持者のユーザ ID。
\end{datadesc}

\begin{datadesc}{ST_GID}
ファイルの所持者のグループ ID。
\end{datadesc}

\begin{datadesc}{ST_SIZE}
通常ファイルではバイトサイズ; いくつかの特殊ファイルでは処理待ちの
データ量。
\end{datadesc}

\begin{datadesc}{ST_ATIME}
最後にアクセスした時刻。
\end{datadesc}

\begin{datadesc}{ST_MTIME}
最後に変更された時刻。
\end{datadesc}

\begin{datadesc}{ST_CTIME}
オペレーティングシステムから返される``ctime''。あるOS(\UNIX など)では最
後にメタデータが更新された時間となり、別のOS(Windowsなど)では作成時間と
なります(詳細については各プラットフォームのドキュメントを参照してください)。
\end{datadesc}

``ファイルサイズ'' の解釈はファイルの型によって異なります。
通常のファイルの場合、サイズはファイルの大きさをバイトで表した
ものです。ほとんどの \UNIX{} 系 (特に Linux) における FIFO やソケット
の場合、``サイズ'' は \function{os.stat()}、 \function{os.fstat()}、
あるいは \function{os.lstat()} を呼び出した時点で読み出し待ちであった
データのバイト数になります; この値は時に有用で、特に上記の特殊なファイル
を非ブロックモードで開いた後にポーリングを行いたいといった場合に
便利です。他のキャラクタ型およびブロック型デバイスにおけるサイズ
フィーるの意味はさらに異なっていて、背後のシステムコールの実装に
よります。

例を以下に示します:

\begin{verbatim}
import os, sys
from stat import *

def walktree(top, callback):
    '''recursively descend the directory tree rooted at top,
       calling the callback function for each regular file'''

    for f in os.listdir(top):
        pathname = os.path.join(top, f)
        mode = os.stat(pathname)[ST_MODE]
        if S_ISDIR(mode):
            # It's a directory, recurse into it
            walktree(pathname, callback)
        elif S_ISREG(mode):
            # It's a file, call the callback function
            callback(pathname)
        else:
            # Unknown file type, print a message
            print 'Skipping %s' % pathname

def visitfile(file):
    print 'visiting', file

if __name__ == '__main__':
    walktree(sys.argv[1], visitfile)
\end{verbatim}
