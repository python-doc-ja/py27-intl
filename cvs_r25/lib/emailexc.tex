\declaremodule{standard}{email.errors}
\modulesynopsis{email パッケージで使われる例外クラス}

\module{email.errors} モジュールでは、
以下の例外クラスが定義されています:

\begin{excclassdesc}{MessageError}{}
これは \module{email} パッケージが発生しうるすべての例外の基底クラスです。
これは標準の \exception{Exception} クラスから派生しており、
追加のメソッドはまったく定義されていません。
\end{excclassdesc}

\begin{excclassdesc}{MessageParseError}{}
これは \class{Parser} クラスが発生しうる例外の基底クラスです。
\exception{MessageError} から派生しています。
\end{excclassdesc}

\begin{excclassdesc}{HeaderParseError}{}
メッセージの \rfc{2822} ヘッダを解析している途中にある条件でエラーがおこると発生します。
これは \exception{MessageParseError} から派生しています。
この例外が起こる可能性があるのは \method{Parser.parse()} メソッドと
\method{Parser.parsestr()} メソッドです。

この例外が発生するのはメッセージ中で最初の \rfc{2822} ヘッダが現れたあとに
エンベロープヘッダが見つかったとか、最初の \rfc{2822} ヘッダが現れる前に
前のヘッダからの継続行が見つかったとかいう状況を含みます。
あるいはヘッダでも継続行でもない行がヘッダ中に見つかった場合でも
この例外が発生します。
\end{excclassdesc}

\begin{excclassdesc}{BoundaryError}{}
メッセージの \rfc{2822} ヘッダを解析している途中にある条件でエラーがおこると発生します。
これは \exception{MessageParseError} から派生しています。
この例外が起こる可能性があるのは \method{Parser.parse()} メソッドと
\method{Parser.parsestr()} メソッドです。

この例外が発生するのは、厳格なパーズ方式が用いられているときに、
\mimetype{multipart/*} 形式の開始あるいは終了の文字列が見つからなかった場合などです。
\end{excclassdesc}

\begin{excclassdesc}{MultipartConversionError}{}
この例外は、
\class{Message} オブジェクトに \method{add_payload()} メソッドを使って
ペイロードを追加するとき、そのペイロードがすでに単一の値である
(訳注: リストでない) にもかかわらず、そのメッセージの \mailheader{Content-Type} 
ヘッダのメインタイプがすでに設定されていて、それが \mimetype{multipart} 以外になって
しまっている場合にこの例外が発生します。
\exception{MultipartConversionError} は \exception{MessageError} と
組み込みの \exception{TypeError} を両方継承しています。

\method{Message.add_payload()} はもはや推奨されないメソッドのため、
この例外はふつうめったに発生しません。しかしこの例外は
\method{attach()} メソッドが \class{MIMENonMultipart} から
派生したクラスのインスタンス (例: \class{MIMEImage} など) に対して
呼ばれたときにも発生することがあります。
\end{excclassdesc}

以下は \class{FeedParser} がメッセージの解析中に検出する障害 (defect) の一覧です。
注意: これらの障害は、問題が見つかったメッセージに追加されるため、たとえば
\mimetype{multipart/alternative} 内にあるネストしたメッセージが
異常なヘッダをもっていた場合には、そのネストしたメッセージが障害を
持っているが、その親メッセージには障害はないとみなされます。

すべての障害クラスは \class{email.errors.MessageDefect} のサブクラスですが、
これは例外とは\emph{違います}ので注意してください。

\versionadded[All the defect classes were added]{2.4}

\begin{itemize}
\item \class{NoBoundaryInMultipartDefect} -- メッセージが multipart だと宣言されているのに、
      \mimetype{boundary} パラメータがない。

\item \class{StartBoundaryNotFoundDefect} -- \mailheader{Content-Type} ヘッダで宣言された
      開始境界がない。

\item \class{FirstHeaderLineIsContinuationDefect} -- メッセージの最初のヘッダが
      継続行から始まっている。

\item \class{MisplacedEnvelopeHeaderDefect} -- ヘッダブロックの途中に ``Unix From'' ヘッダがある。

\item \class{MalformedHeaderDefect} -- コロンのないヘッダがある、あるいはそれ以外の異常なヘッダである。

\item \class{MultipartInvariantViolationDefect} -- メッセージが \mimetype{multipart} だと
      宣言されているのに、サブパートが存在しない。注意: メッセージがこの障害を持っているとき、
      \method{is_multipart()} メソッドは たとえその content-type が \mimetype{multipart} であっても
      false を返すことがあります。
\end{itemize}
