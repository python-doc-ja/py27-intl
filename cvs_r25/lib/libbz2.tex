\section{\module{bz2} ---
         \program{bzip2} 互換の圧縮ライブラリ}

\declaremodule{builtin}{bz2}
\modulesynopsis{\program{bzip2} 互換の圧縮／解凍ルーチンへのインタフェース}
\moduleauthor{Gustavo Niemeyer}{niemeyer@conectiva.com}
\sectionauthor{Gustavo Niemeyer}{niemeyer@conectiva.com}
% \translators[ja]{Yasushi Masuda}{y.masuda@acm.org}
\versionadded{2.3}

このモジュールでは bz2 圧縮ライブラリのためのわかりやすいインタフェースを
提供します。モジュールでは完全なファイルインタフェース、データを一括
して圧縮（解凍）する関数、データを逐次的に圧縮（解凍）するためのクラス
型を実装しています。

bz2 モジュールで提供されている機能を以下にまとめます:

\begin{itemize}
\item \class{BZ2File} クラスは、\method{readline()}, \method{readlines()},
  \method{writelines()}, \method{seek()} 等を含む、完全な
  ファイルインタフェースを実装します。
\item \class{BZ2File} クラスは \method{seek()} をエミュレーションで
  サポートします。
\item \class{BZ2File} クラスは広範囲の改行文字バリエーションを
  サポートします。
\item \class{BZ2File} クラスはファイルオブジェクトで言うところの先読み
  アルゴリズムを用いた行単位のイテレーション機能を提供します。
\item \class{BZ2Compressor} および\class{BZ2Decompressor} クラスでは
  逐次的圧縮（解凍）をサポートしています。
\item \function{compress()} および\function{decompress()} では
  一括圧縮（解凍）を関数サポートしています。
\item 個別のロックメカニズムによってスレッド安全性を持っています。
\item 埋め込みドキュメントが完備しています。
\end{itemize}


\subsection{ファイルの圧縮（解凍）}

\class{BZ2File} クラスは圧縮ファイルの操作機能を提供しています。

\begin{classdesc}{BZ2File}{filename\optional{, mode\optional{,
                           buffering\optional{, compresslevel}}}}
bz2 ファイルを開きます。ファイルのモードは \code{'r'} または
\code{'w'} で、それぞれ読み出しと書き込みに対応します。
書き出し用に開いた場合、ファイルが存在しないなら新しく作成し、
そうでない場合ファイルを切り詰ます。
\var{buffering} パラメタを与えた場合、\code{0} はバッファリング
なしを表し、それよりも大きい値はバッファサイズになります。
デフォルトでは \code{0} です。圧縮レベル\var{compresslevel} 
を与える場合、値は \code{1} から \code{9} までの整数値でなければ
なりません。デフォルトの値は \code{9} です。
ファイルへの入力に広範囲の改行文字バリエーションをサポートさせたい
場合は \character{U} をファイルモードに追加します。
入力ファイルの行末はどれも、Pythonからは \character{\e n} として見えます。
また、また、開かれているファイルオブジェクトは \member{newlines} 属性
を持ち、\code{None} (まだ改行文字を読み込んでいない時), \code{'\e r'}, 
\code{'\e n'}, \code{'\e r\e n'} または全ての改行文字バリエーション
を含むタプルになります。広範囲の改行文字サポートが利用できるのは
読み込みだけです。\class{BZ2File} が生成するインスタンスは通常の
ファイルインスタンスと同様のイテレーション操作をサポートしています。
\end{classdesc}

\begin{methoddesc}[BZ2File]{close}{}
ファイルを閉じます。オブジェクトのデータ属性 \member{closed} を真に
します。閉じたファイルはそれ以後入出力操作の対象にできません。
\method{close()} 自体の呼び出しはエラーを引き起こすことなく何度も
実行できます。
\end{methoddesc}

\begin{methoddesc}[BZ2File]{read}{\optional{size}}
最大で \var{size} バイトの解凍されたデータを読み出し、文字列として
返します。\var{size} 引数を負の値にした場合や省略した場合、EOF に
たどり着くまで読み出します。
\end{methoddesc}

\begin{methoddesc}[BZ2File]{readline}{\optional{size}}
ファイルから次の 1 行を読み出し、改行文字も含めて文字列を返します。
負でない \var{size} 値は、返される文字列の最大バイト長を制限します
(その場合不完全な行を返すこともあります)。 EOF の時には空文字列
を返します。
\end{methoddesc}

\begin{methoddesc}[BZ2File]{readlines}{\optional{size}}
ファイルから読み取った各行の文字列からなるリストを返します。
オプション引数 \var{size} を与えた場合、文字列リストの
合計バイト長の大まかな上限の指定になります。
\end{methoddesc}

\begin{methoddesc}[BZ2File]{xreadlines}{}
前のバージョンとの互換性のために用意されています。 \class{BZ2File} 
オブジェクトはかつて \module{xreadlines} モジュールで提供されて
いたパフォーマンス最適化を含んでいます。
\deprecated{2.3}{このメソッドは \class{file} オブジェクトの同名の
	メソッドとの互換性のために用意されていますが、現在は推奨されない
	メソッドです。代りに \code{for line in file} を使ってください。}
\end{methoddesc}

\begin{methoddesc}[BZ2File]{seek}{offset\optional{, whence}}
ファイルの読み書き位置を移動します。 引数 \var{offset} はバイト数で
指定したオフセット値です。
オプション引数 \var{whence} はデフォルトで \code{0} (ファイルの
先頭からのオフセットで、offset \code{>= 0} になるはず) です。
他にとり得る値は \code{1} (現在のファイル位置からの相対位置で、正負
どちらの値もとり得る)、および \code{2} (ファイルの終末端からの相対位置で、
通常は負の値になるが、多くのプラットフォームではファイルの終末端を
越えて seek できる) です。

bz2 ファイルの seek はエミュレーションであり、パラメタの設定によっては
処理が非常に低速になるかもしれないので注意してください。
\end{methoddesc}

\begin{methoddesc}[BZ2File]{tell}{}
現在のファイル位置を整数（long 整数になるかもしれません）で返します。
\end{methoddesc}

\begin{methoddesc}[BZ2File]{write}{data}
ファイルに文字列 \var{data} を書き込みます。バッファリングのため、
ディスク上のファイルに書き込まれたデータを反映させるには
\method{close()} が必要になるかもしれないので注意してください。
\end{methoddesc}

\begin{methoddesc}[BZ2File]{writelines}{sequence_of_strings}
複数の文字列からなるシーケンスをファイルに書き込みます。それぞれの
文字列を書き込む際に改行文字を追加することはありません。
シーケンスはイテレーション処理で文字列を取り出せる任意のオブジェクトに
できます。この操作はそれぞれの文字列を write() を呼んで
書き込むのと同じ操作です。
\end{methoddesc}


\subsection{逐次的な圧縮（解凍）}

逐次的な圧縮および解凍は \class{BZ2Compressor} および 
\class{BZ2Decompressor} クラスを用いて行います。

\begin{classdesc}{BZ2Compressor}{\optional{compresslevel}}
新しい圧縮オブジェクトを作成します。このオブジェクトはデータを逐次的に
圧縮できます。一括してデータを圧縮したいのなら、\function{compress()}
関数を代りに使ってください。\var{compresslevel} パラメタを与える場合、
この値は \code{1} and \code{9} の間の整数でなければなりません。
デフォルトの値は \code{9} です。
\end{classdesc}

\begin{methoddesc}[BZ2Compressor]{compress}{data}
圧縮オブジェクトに追加のデータを入力します。圧縮データの
チャンクを生成できた場合にはチャンクを返します。圧縮データの入力を
終えた後は圧縮処理を終えるために \method{flush()} を呼んでください。
内部バッファに残っている未処理のデータを返します。
\end{methoddesc}

\begin{methoddesc}[BZ2Compressor]{flush}{}
圧縮処理を終え、内部バッファに残されているデータを返します。
このメソッドの呼び出し以降は同じ圧縮オブジェクトを使ってはなりません。
\end{methoddesc}

\begin{classdesc}{BZ2Decompressor}{}
新しい解凍オブジェクトを生成します。このオブジェクトは逐次的にデータ
を解凍できます。一括してデータを解凍したいのなら、
\function{decompress()} 関数を代りに使ってください。
\end{classdesc}

\begin{methoddesc}[BZ2Decompressor]{decompress}{data}
解凍オブジェクトに追加のデータを入力します。可能な限り、解凍データの
チャンクを生成できた場合にはチャンクを返します。ストリームの末端に到達
した後に解凍処理を行おうとした場合には、例外 \exception{EOFError} を
送出します。ストリームの終末端の後ろに何らかのデータがあった場合、
解凍処理はこのデータを無視し、オブジェクトの \member{unused\_data} 
属性に収めます。
\end{methoddesc}


\subsection{一括圧縮（解凍）}

一括での圧縮および解凍を行うための関数、\function{compress()} および
\function{decompress()} が提供されています。

\begin{funcdesc}{compress}{data\optional{, compresslevel}}
\var{data} を一括して圧縮します。データを逐次的に圧縮したいなら、
\class{BZ2Compressor} を代りに使ってください。もし \var{compresslevel}
パラメタを与えるなら、この値は \code{1} から \code{9} をとらなくては
なりません。デフォルトの値は \code{9} です。
\end{funcdesc}

\begin{funcdesc}{decompress}{data}
\var{data} を一括して解凍します。データを逐次的に解凍したいなら、
\class{BZ2Decompressor} を代りに使ってください。
\end{funcdesc}
