\section{\module{htmllib} ---
         HTML 文書の解析器}

\declaremodule{standard}{htmllib}
\modulesynopsis{HTML 文書の解析器。}

\index{HTML}
\index{hypertext}


このモジュールでは、ハイパーテキスト記述言語 (HTML, HyperText Mark-up 
Language) 形式で書式化されたテキストファイルを解析するための基盤として
役立つクラスを定義しています。このクラスは I/O と直接的には接続
されません --- このクラスにはメソッドを介して文字列形式の入力を
提供する必要があり、出力を生成するには ``フォーマッタ (formatter)''
オブジェクトのメソッドを何度か呼び出さなくてはなりません。

\class{HTMLParser} クラスは、機能を追加するために他のクラスの基底クラス
として利用するように設計されており、ほとんどのメソッドが拡張したり
上書きしたりできるようになっています。
さらにこのクラスは \refmodule{sgmllib}\refstmodindex{sgmllib} モジュール
で定義されている \class{SGMLParser} クラスから導出されており、その機能
を拡張しています。\class{HTMLParser} の実装は、\rfc{1866}
で解説されている HTML 2.0 記述言語をサポートします。
\refmodule{formatter}\refstmodindex{formatter} では 2 つのフォーマッタ
オブジェクト実装が提供されています; フォーマッタのインタフェースに
ついての情報は \refmodule{formatter} モジュールのドキュメントを参照
してください。
\withsubitem{(in module sgmllib)}{\ttindex{SGMLParser}}

以下は \class{sgmllib.SGMLParser} で定義されているインタフェースの
概要です:

\begin{itemize}

\item
インスタンスにデータを与えるためのインタフェースは \method{feed()}
メソッドで、このメソッドは文字列を引数に取ります。
このメソッドに一度に与えるテキストは必要に応じて多くも少なくも
できます; というのは \samp{p.feed(a);p.feed(b)} は \samp{p.feed(a+b)} 
と同じ効果を持つからです。
与えられたデータが完全な HTML マークアップ文を含む場合、それらの文は
即座に処理されます; 不完全なマークアップ構造はバッファに保存されます。
全ての未処理データを強制的に処理させるには、 \method{close()} 
メソッドを呼び出します。

例えば、ファイルの全内容を解析するには:
\begin{verbatim}
parser.feed(open('myfile.html').read())
parser.close()
\end{verbatim}
のようにします。

\item
HTML タグに対して意味付けを定義するためのインタフェースはとても
単純です: サブクラスを導出して、\method{start_\var{tag}()}、
\method{end_\var{tag}()}、あるいは \method{do_\var{tag}()}
といったメソッドを定義するだけです。
パーザはこれらのメソッドを適切なタイミングで呼び出します: 
\method{start_\var{tag}} や \method{do_\var{tag}()} は 
\code{<\var{tag} ...>} の形式の開始タグに遭遇した時に呼び出されます;
\method{end_\var{tag}()} は \code{<\var{tag}>} の形式の終了タグに
遭遇した時に呼び出されます。\code{<H1>} ... \code{</H1>} のように
開始タグが終了タグと対応している必要がある場合、クラス中で
\method{start_\var{tag}()} が定義されていなければなりません;
\code{<P>} のように終了タグが必要ない場合、クラス中では
\method{do_\var{tag}()} を定義しなければなりません。

\end{itemize}

このモジュールではパーザクラスと例外を一つづつ定義しています:

\begin{classdesc}{HTMLParser}{formatter}
基底となる HTML パーザクラスです。XHTML 1.0 仕様 
(\url{http://www.w3.rog/TR/xhtml1}) 勧告で要求されている
全てのエンティティ名をサポートしています。
\end{classdesc}

\begin{excdesc}{HTMLParseError}
\class{HTMLParser} クラスがパーズ処理中にエラーに遭遇した場合に
送出する例外です。
\versionadded{2.4}
\end{excdesc}

\begin{seealso}
  \seemodule{formatter}{抽象化された書式イベントの流れを
writer オブジェクト上の特定の出力イベントに変換するための
インターフェース。}
  \seemodule{HTMLParser}{HTML パーザのひとつです。やや低いレベル
でしか入力を扱えませんが、XHTML を扱うことができるように設計
されています。``広く知られている HTML (HTML as deployed)'' では
使われておらずかつ XHTML では正しくないとされる SGML 構文のいくつか
は実装されていません。}
  \seemodule{htmlentitydefs}{XHTML 1.0 エンティティに対する置換
テキストの定義。}
  \seemodule{sgmllib}{\class{HTMLParser} の基底クラス。}
\end{seealso}


\subsection{HTMLParser オブジェクト \label{html-parser-objects}}

タグメソッドに加えて、\class{HTMLParser} クラスではタグメソッド
で利用するためのいくつかのメソッドとインスタンス変数を提供しています。

\begin{memberdesc}{formatter}
パーザに関連付けられているフォーマッタインスタンスです。
\end{memberdesc}

\begin{memberdesc}{nofill}
ブール値のフラグで、空白文字を縮約したくないときには真、縮約するときには
偽にします。一般的には、この値を真にするのは、\code{<PRE>} 要素の
中のテキストのように、文字列データが ``書式化済みの (preformatted)'' 
場合だけです。標準の値は偽です。この値は 
\method{handle_data()} および \method{save_end()} の操作に影響します。
\end{memberdesc}


\begin{methoddesc}{anchor_bgn}{href, name, type}
このメソッドはアンカー領域の先頭で呼び出されます。引数は 
\code{<A>} タグの属性で同じ名前を持つものに対応します。
標準の実装では、ドキュメント内のハイパーリンク 
(\code{<A>} タグの \code{HREF} 属性) を列挙したリスト
を維持しています。ハイパーリンクのリストはデータ属性
\member{anchorlist} で手に入れることができます。
\end{methoddesc}

\begin{methoddesc}{anchor_end}{}
このメソッドはアンカー領域の末尾で呼び出されます。標準の
実装では、テキストの注釈マーカを追加します。マーカは 
\method{anchor_bgn()} で作られたハイパーリンクリストの
インデクス値です。
\end{methoddesc}

\begin{methoddesc}{handle_image}{source, alt\optional{, ismap\optional{,
                                 align\optional{, width\optional{, height}}}}}
このメソッドは画像を扱うために呼び出されます。標準の実装では、
単に \method{handle_data()} に \var{alt} の値を渡すだけです。
\end{methoddesc}

\begin{methoddesc}{save_bgn}{}
文字列データをフォーマッタオブジェクトに送らずにバッファに保存
する操作を開始します。保存されたデータは \method{save_end()}
で取得してください。 \method{save_bgn()} / \method{save_end()} 
のペアを入れ子構造にすることはできません。
\end{methoddesc}

\begin{methoddesc}{save_end}{}
文字列データのバッファリングを終了し、以前 \method{save_bgn()} 
を呼び出した時点から保存されている全てのデータを返します。
\member{nofill} フラグが偽の場合、空白文字は全てスペース文字
一文字に置き換えられます。予め \method{save_bgn()} を呼ばないで
このメソッドを呼び出すと \exception{TypeError} 例外が送出されます。
\end{methoddesc}



\section{\module{htmlentitydefs} ---
         HTML 一般エンティティの定義}

\declaremodule{standard}{htmlentitydefs}
\modulesynopsis{HTML 一般エンティティの定義。}
\sectionauthor{Fred L. Drake, Jr.}{fdrake@acm.org}

このモジュールでは\code{entitydefs}、\code{codepoint2name}、\code{entitydefs}
の三つの辞書を定義しています。
\code{entitydefs}は\refmodule{htmllib} モジュールで \class{HTMLParser} クラスの
\member{entitydefs} メンバを定義するために使われます。
このモジュールでは XHTML 1.0 で定義された全てのエンティティを提供しており、
Latin-1 キャラクタセット (ISO-8859-1)の簡単なテキスト置換を行う事ができます。

\begin{datadesc}{entitydefs}
  各 XHTML 1.0 エンティティ定義について、ISO Latin-1 における置換
  テキストへの対応付けを行っている辞書です。
\end{datadesc}

\begin{datadesc}{name2codepoint}
  HTMLのエンティティ名をUnicodeのコードポイントに変換するための辞書です。
  \versionadded{2.3}
\end{datadesc}

\begin{datadesc}{codepoint2name}
  A dictionary that maps Unicode codepoints to HTML entity names.
  UnicodeのコードポイントをHTMLのエンティティ名に変換するための辞書です。
  \versionadded{2.3}
\end{datadesc}
