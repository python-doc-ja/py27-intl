\section{\module{sunaudiodev} ---
Sunオーディオハードウェアへのアクセス}
\declaremodule{builtin}{sunaudiodev}
  \platform{SunOS}
\modulesynopsis{
Sunオーディオハードウェアへのアクセス}

このモジュールを使うと、Sunのオーディオインターフェースにアクセスでき
ます。
Sunオーディオハードウェアは、
1秒あたり8kのサンプリングレート、
u-LAW\index{u-LAW}フォーマットでオーディオデータを録音、再生できます。
完全な説明文書はマニュアルページ\manpage{audio}{7I}にあります。

モジュール
\refmodule[sunaudiodev-constants]{SUNAUDIODEV}\refstmodindex{SUNAUDIODEV}
には、このモジュールで使われる定数が定義されています。

このモジュールには、以下の変数と関数が定義されています：

\begin{excdesc}{error}
この例外は、全てのエラーについて発生します。
引数は誤りを説明する文字列です。
\end{excdesc}

\begin{funcdesc}{open}{mode}
この関数はオーディオデバイスを開き、Sunオーディオデバイスのオブジェクト
を返します。
こうすることで、オブジェクトがI/Oに使用できるようになります。
パラメータ\var{mode}は次のうちのいずれか一つで、
録音のみには\code{'r'}、再生のみには\code{'w'}、
録音と再生両方には\code{'rw'}、コントロールデバイスへのアクセスには
\code{'control'}です。
レコーダーやプレーヤーには同時に１つのプロセスしかアクセスが許されていな
いので、必要な動作についてだけデバイスをオープンするのがいい考えです。
詳しくは\manpage{audio}{7I}を参照してください。
マニュアルページにあるように、このモジュールは環境変数
\code{AUDIODEV}の中のベースオーディオデバイスファイルネームを初めに参照
します。
見つからない場合は\file{/dev/audio}を参照します。
コントロールデバイスについては、ベースオーディオデバイスに``ctl''を
加えて扱われます。
\end{funcdesc}


\subsection{オーディオデバイスオブジェクト \label{audio-device-objects}}

オーディオデバイスオブジェクトは\function{open()}で返され、このオブジェ
クトには以下のメソッドが定義されています
（\code{control}オブジェクトは除きます。これには\method{getinfo()}、
\method{setinfo()}、\method{fileno()}、\method{drain()}だけが定義されて
います）：

\begin{methoddesc}[audio device]{close}{}
このメソッドはデバイスを明示的に閉じます。
オブジェクトを削除しても、それを参照しているものがあって、すぐに閉じてく
れない場合に便利です。
閉じられたデバイスを使うことはできません。
\end{methoddesc}

\begin{methoddesc}[audio device]{fileno}{}
デバイスに関連づけられたファイルディスクリプタを返します。
これは、後述の\code{SIGPOLL}の通知を組み立てるのに使われます。
\end{methoddesc}

\begin{methoddesc}[audio device]{drain}{}
このメソッドは全ての出力中のプロセスが終了するまで待って、それから制御が
戻ります。
このメソッドの呼び出しはそう必要ではありません：
オブジェクトを削除すると自動的にオーディオデバイスを閉じて、暗黙のうちに
吐き出します。
\end{methoddesc}

\begin{methoddesc}[audio device]{flush}{}
このメソッドは全ての出力中のものを捨て去ります。
ユーザの停止命令に対する反応の遅れ（1秒までの音声のバッファリングによっ
て起こります）を避けるのに使われます。
\end{methoddesc}

\begin{methoddesc}[audio device]{getinfo}{}
このメソッドは入出力のボリューム値などの情報を引き出して、オーディオス
テータスのオブジェクト形式で返します。
このオブジェクトには何もメソッドはありませんが、現在のデバイスの状態を示
す多くの属性が含まれます。
属性の名称と意味は\code{<sun/audioio.h>}と\manpage{audio}{7I}に記載があ
ります。
メンバー名は相当するCのものとは少し違っています：
ステータスオブジェクトは１つの構造体です。
その中の構造体である\cdata{play}のメンバーには名前の初めに\samp{o_}がつ
いていて、\cdata{record}には\samp{i_}がついています。
そのため、Cのメンバーである\cdata{play.sample_rate}は
\member{o_sample_rate}として、\cdata{record.gain}は\member{i_gain}として
参照され、
\cdata{monitor_gain}はそのまま\member{monitor_gain}で参照されます。
\end{methoddesc}

\begin{methoddesc}[audio device]{ibufcount}{}
このメソッドは録音側でバッファリングされるサンプル数を返します。
つまり、プログラムは同じ大きさのサンプルに対する\function{read()}の
呼び出しをブロックしません。
\end{methoddesc}

\begin{methoddesc}[audio device]{obufcount}{}
このメソッドは再生側でバッファリングされるサンプル数を返します。
残念ながら、この数値はブロックなしに書き込めるサンプル数を調べるのには
使えません。というのは、カーネルの出力キューの長さは可変だからです。
\end{methoddesc}

\begin{methoddesc}[audio device]{read}{size}
このメソッドはオーディオ入力から\var{size}のサイズのサンプルを読み込ん
で、Pythonの文字列として返します。
この関数は必要なデータが得られるまで他の操作をブロックします。
\end{methoddesc}

\begin{methoddesc}[audio device]{setinfo}{status}
このメソッドはオーディオデバイスのステータスパラメータを設定します。
パラメータ\var{status}は\function{getinfo()}で返されたり、
プログラムで変更されたオーディオステータスオブジェクトです。
\end{methoddesc}

\begin{methoddesc}[audio device]{write}{samples}
パラメータとしてオーディオサンプルをPython文字列を受け取り、再生します。
もし十分なバッファの空きがあればすぐに制御が戻り、そうでないならブロック
されます。
\end{methoddesc}

オーディオデバイスはSIGPOLLを介して様々なイベントの非同期通知に対応して
います。
Pythonでこれをどのようにしたらできるか、例を挙げます：

\begin{verbatim}
def handle_sigpoll(signum, frame):
    print 'I got a SIGPOLL update'

import fcntl, signal, STROPTS

signal.signal(signal.SIGPOLL, handle_sigpoll)
fcntl.ioctl(audio_obj.fileno(), STROPTS.I_SETSIG, STROPTS.S_MSG)
\end{verbatim}


\section{\module{SUNAUDIODEV} ---
\module{sunaudiodev}で使われる定数}
\declaremodule[sunaudiodev-constants]{standard}{SUNAUDIODEV}
  \platform{SunOS}
\modulesynopsis{\module{sunaudiodev}で使われる定数。}


これは\refmodule{sunaudiodev}\refbimodindex{sunaudiodev}に付随する
モジュールで、\constant{MIN_GAIN}、\constant{MAX_GAIN}、
\constant{SPEAKER}などの便利なシンボル定数を定義しています。
定数の名前はCのincludeファイル\code{<sun/audioio.h>}のものと同じで、
初めの文字列 \samp{AUDIO_}を除いたものです。